Param(
    $DomainName                    = "lab.local",
    $NetbiosName                   = "LAB",
    $SafeModeAdministratorPassword = "Myanmar@123#",
    $MarkerFilename                = "$emv:TEMP\ADDS-FOREST.mark"
)

$user = [adsi]"WinNT://localhost/Administrator,user"
$user.SetPassword("Passw0rd")
$user.SetInfo()

Set-StrictMode -Version Latest 
$ErrorActionPreference = "Stop"

if (Test-Path $MarkerFilename) {
    Write-Host "We re-entered ADDS Forest installation! Exiting..."
    return
}

Install-WindowsFeature -Name AD-Domain-Services -IncludeManagementTools
Import-Module ADDSDeployment

Write-Host "Starting ADDS Forest installation..." 
Install-ADDSForest `
    -DatabasePath "C:\Windows\NTDS" `
    -CreateDnsDelegation:$false `
    -DomainMode "7" `
    -DomainName $DomainName `
    -ForestMode "7" `
    -InstallDns:$true `
    -DomainNetbiosName $NetbiosName `
    -LogPath "C:\Windows\NTDS" `
    -SysvolPath "C:\Windows\SYSVOL" `
    -NoRebootOnCompletion:$false `
    -safemodeadministratorpassword (ConvertTo-SecureString $SafeModeAdministratorPassword -asplaintext -force) `
    -Force:$true

"Done" | Out-File $MarkerFilename