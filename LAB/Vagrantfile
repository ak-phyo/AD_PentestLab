Vagrant.configure("2") do |config|  
    config.vagrant.plugins = "vagrant-reload"
    config.vm.define "dc1" do |dc1|
      dc1.vm.box = "jacqinthebox/windowsserver2016"
      dc1.vm.hostname = "dc1"
      dc1.vm.provider :virtualbox do |vb|
        vb.gui = false
      end
      dc1.vm.network "private_network", ip: "192.168.120.2" , name: "VirtualBox Host-Only Ethernet Adapter #4"
      dc1.winrm.username = "vagrant"
      dc1.winrm.password = "vagrant"
      dc1.winrm.transport = :plaintext
      dc1.winrm.basic_auth_only = true 
      dc1.vm.provision "shell", path: "provision/Install_AD.ps1"
      dc1.vm.provision :reload
      dc1.vm.provision "shell", path: "provision/Vuln_AD.ps1"
      dc1.vm.provision :reload
    end
      
    config.vm.define "lab1" do |lab1|
      lab1.vm.box = "jacqinthebox/windowsserver2016"
      lab1.vm.hostname = "lab1"
      lab1.vm.provider :virtualbox do |sv|
        sv.gui = false
      end
      lab1.vm.network "private_network", ip: "192.168.120.10", name: "VirtualBox Host-Only Ethernet Adapter #4"
      lab1.winrm.username = "vagrant"
      lab1.winrm.password = "vagrant"
      lab1.winrm.transport = :plaintext
      lab1.winrm.basic_auth_only = true
      lab1.vm.provision "shell",
        path: "provision\\ConfigureRebootOnNode.ps1"
      lab1.vm.provision "shell",
        path: "provision\\Join_AD.ps1"
      lab1.vm.provision :reload
    end

    config.vm.define "kali" do |kali|
      kali.vm.box = "kalilinux/rolling"
      kali.vm.hostname = "kali"
      kali.vm.provider :virtualbox do |vb|
          vb.gui = false
        end
      kali.vm.network "private_network", ip: "192.168.120.15",
          name: "VirtualBox Host-Only Ethernet Adapter #4"
      kali.vm.provision :reload
      kali.vm.provision "shell", inline: <<-SHELL
          apt-get update
          apt-get install covenant-kbx git -y
          cd /opt/ && git clone https://github.com/samratashok/nishang.git
      SHELL
    end
end
